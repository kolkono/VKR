{% extends "base.html" %}

{% block title %}Детали заявки №{{ service_request.id }}{% endblock %}

{% block content %}
  <h2>Заявка №{{ service_request.id }}</h2>

  <p><strong>Устройство:</strong> {{ service_request.device.name }} ({{ service_request.device.serial_number }})</p>
  <p><strong>Статус заявки:</strong> 
    {% if service_request.is_completed %}
      Завершена
    {% else %}
      В работе
    {% endif %}
  </p>

  <hr>

  <h3>Журнал действий инженера</h3>
  {% if logs %}
    <ul>
      {% for log in logs %}
        <li>
          <strong>{{ log.action_type }}</strong><br>
          {% if log.notes %}
            Примечание: {{ log.notes }}<br>
          {% endif %}
          <small>Дата: {{ log.action_date|date:"d.m.Y H:i" }}, Инженер: {{ log.engineer.username }}</small>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>Нет записей в журнале.</p>
  {% endif %}

  {% if replacement_request %}
    <hr>
    <h3>Запрос на замену устройства №{{ replacement_request.id }}</h3>
    <p><strong>Инженер:</strong> {{ replacement_request.engineer.username }}</p>
    <p><strong>Причина замены:</strong> {{ replacement_request.reason|linebreaks }}</p>
    <p><strong>Статус одобрения:</strong> 
      {% if replacement_request.admin_approved %}
        Одобрен
      {% else %}
        Ожидает одобрения
      {% endif %}
    </p>

    {% if replacement_report %}
      <hr>
      <h4>Отчёт по замене</h4>
      <p><strong>Дата создания:</strong> {{ replacement_report.created_at|date:"d.m.Y H:i" }}</p>
      <p><strong>Создатель:</strong> {{ replacement_report.created_by.username }}</p>
      <p><strong>Описание:</strong> {{ replacement_report.description|linebreaks }}</p>
    {% else %}
      {% if not service_request.is_completed %}
        <p>Отчёт по замене ещё не добавлен.</p>
        {# Здесь можно добавить форму для создания отчёта, если она есть #}
      {% else %}
        <p>Отчёт по замене не добавлен.</p>
      {% endif %}
    {% endif %}
  {% endif %}

  {% if not service_request.is_completed %}
    <div class="action-buttons">
      {# Например, кнопки редактирования или отправки формы #}
      <a href="{% url 'admin_dashboard' %}" class="btn">← Назад в панель администратора</a>
      {# Можно добавить дополнительные кнопки здесь #}
    </div>
  {% else %}
    <div class="action-buttons">
      <a href="{% url 'admin_dashboard' %}" class="btn">← Назад в панель администратора</a>
    </div>
  {% endif %}
{% endblock %}
