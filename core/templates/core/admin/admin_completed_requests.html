{% extends "base.html" %}

{% block title %}Завершённые заявки (админ){% endblock %}

{% block content %}
<h1>Завершённые заявки (админ)</h1>

<form method="get" style="margin-bottom: 20px;">
  <label>
    Здание:
    <select name="building" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px;">
      <option value="">Все</option>
      {% for b in buildings %}
        <option value="{{ b }}" {% if selected_building == b %}selected{% endif %}>{{ b }}</option>
      {% endfor %}
    </select>
  </label>

  <label style="margin-left: 15px;">
    Кабинет:
    <select name="cabinet" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px;">
      <option value="">Все</option>
      {% for c in cabinets %}
        <option value="{{ c.id }}" {% if selected_cabinet == c.id|stringformat:"s" %}selected{% endif %}>
          {{ c.building }} - {{ c.number }}
        </option>
      {% endfor %}
    </select>
  </label>

  <button type="submit" style="margin-left: 15px; padding: 6px 12px; border-radius: 4px; border: none; background-color: #007acc; color: white; font-weight: 600; cursor: pointer;">
    Фильтровать
  </button>
</form>

<table style="width: 100%; border-collapse: collapse;">
  <thead style="background-color: #f0f0f0;">
    <tr>
      <th style="border: 1px solid #ccc; padding: 8px; text-align: center;">ID</th>
      <th style="border: 1px solid #ccc; padding: 8px; text-align: center;">Устройство</th>
      <th style="border: 1px solid #ccc; padding: 8px; text-align: center;">Кабинет</th>
      <th style="border: 1px solid #ccc; padding: 8px; text-align: center;">Дата создания</th>
      <th style="border: 1px solid #ccc; padding: 8px; text-align: center;">Создал</th>
      <th style="border: 1px solid #ccc; padding: 8px; text-align: center;">Действия</th>
    </tr>
  </thead>
  <tbody>
    {% for req in requests %}
    <tr>
      <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">{{ req.id }}</td>
      <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">{{ req.device.name }}</td>
      <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">
        {{ req.device.cabinet.building }} - {{ req.device.cabinet.number }}
      </td>
      <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">{{ req.created_at|date:"d.m.Y H:i" }}</td>
      <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">{{ req.created_by.username }}</td>
      <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">
        <a href="{% url 'admin_request_detail' req.id %}">Просмотр</a>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="6" style="border: 1px solid #ccc; padding: 8px; text-align: center;">Нет заявок</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
