
{% extends 'base.html' %}
{% block title %}Мои активные заявки{% endblock %}
{% block content %}
  <h2>Мои активные заявки</h2>

  <form method="get" style="margin-bottom: 20px;">
    <label>Корпус:
      <select name="building">
        <option value="">Все</option>
        {% for b in buildings %}
          <option value="{{ b }}" {% if selected_building == b %}selected{% endif %}>{{ b }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Аудитория:
      <select name="cabinet">
        <option value="">Все</option>
        {% for c in cabinets %}
          <option value="{{ c.id }}" {% if selected_cabinet == c.id|stringformat:"s" %}selected{% endif %}>
            {{ c.number }}
          </option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">Фильтровать</button>
  </form>

  {% if requests %}
    <table style="width: 100%; border-collapse: collapse; border: 1px solid #ccc;">
      <thead>
        <tr style="background-color: #007acc; color: white;">
          <th style="padding: 10px; border: 1px solid #ccc;">Корпус</th>
          <th style="padding: 10px; border: 1px solid #ccc;">Аудитория</th>
          <th style="padding: 10px; border: 1px solid #ccc;">Устройство</th>
          <th style="padding: 10px; border: 1px solid #ccc;">Дата</th>
          <th style="padding: 10px; border: 1px solid #ccc;">Статус</th>
        </tr>
      </thead>
      <tbody>
        {% for req in requests %}
          {% if req.is_completed %}
            {% set status_color = 'green' %}
          {% elif req.assigned_engineer %}
            {% set status_color = 'orange' %}
          {% else %}
            {% set status_color = 'red' %}
          {% endif %}
          <tr>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ req.device.cabinet.building }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ req.device.cabinet.number }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ req.device.name }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ req.created_at|date:"d.m.Y H:i" }}</td>
            <td style="padding: 10px; border: 1px solid #ccc; font-weight: 600; color: {{ status_color }};">
              {{ req.status }}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Заявки не найдены.</p>
  {% endif %}
{% endblock %}
